<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fan Club</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: #fff;
      padding: 20px;
    }

    h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      position: relative;
    }

    #search, #sortSelect, #showFavoritesBtn {
      padding: 10px 14px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      outline: none;
    }

    #search {
      width: 200px;
    }

    #showFavoritesBtn {
      background-color: #f06292;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s;
    }

    #showFavoritesBtn:disabled {
      background-color: #999;
      cursor: not-allowed;
    }

    #showFavoritesBtn:hover:enabled {
      background-color: #ec407a;
    }

    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
    }

    .box {
      background: #ffffff10;
      backdrop-filter: blur(10px);
      border: 1px solid #ffffff30;
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      position: relative;
      overflow: hidden;
    }

    .box:hover {
      transform: scale(1.03);
      box-shadow: 0 6px 18px rgba(255, 255, 255, 0.2);
    }

    .profile-pic {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #fff;
      margin-bottom: 10px;
    }

    .username {
      font-size: 17px;
      font-weight: bold;
      color: #fff;
      margin-top: 6px;
    }

    .stars-row {
      color: white;
      font-size: 26px;
      margin-top: 6px;
      cursor: pointer;
    }

    .star {
      color: white;
      transition: color 0.3s;
    }

    .star.selected {
      color: gold;
    }

    .favorite-btn {
      position: absolute;
      top: 8px;
      right: 10px;
      background: none;
      border: none;
      font-size: 22px;
      cursor: pointer;
      color: #f06292;
      z-index: 2;
    }

    .favorite-btn.inactive {
      color: #ccc;
      opacity: 0.7;
    }

    .falling-heart,
    .falling-star {
      position: fixed;
      top: -30px;
      font-size: 28px;
      animation: fall 2s ease-in forwards;
      z-index: 9999;
      pointer-events: none;
    }

    .falling-heart {
      color: #f06292;
    }

    .falling-star {
      color: gold;
    }

    @keyframes fall {
      0% { opacity: 1; transform: translateY(0) rotate(0deg); }
      100% { opacity: 0; transform: translateY(400px) rotate(360deg); }
    }

    #toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #333;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      z-index: 999;
    }

    #toast.show {
      opacity: 1;
      pointer-events: auto;
    }

    @media (max-width: 480px) {
      .container {
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      }
    }
  </style>
</head>
<body>

<h2>User Profiles</h2>
<div id="controls">
  <input type="text" id="search" placeholder="Search usernames...">
  <select id="sortSelect">
    <option value="az">Sort A-Z</option>
    <option value="za">Sort Z-A</option>
    <option value="favcount">Most Favorites</option>
  </select>
  <button id="showFavoritesBtn">❤️ Show Favorites 0</button>
</div>

<div class="container" id="container"></div>
<div id="toast">Added to Favorites!</div>

<audio id="heartSound" src="favori.mp3"></audio>
<audio id="starClickSound" src="yildiz.mp3"></audio>

<script>
  const users = [
    { username: "aaydasss", image: "https://i.hizliresim.com/o92hrwi.jpg", favCount: 0 },
    { username: "addisonraee", image: "https://i.hizliresim.com/q44m4o2.jpg", favCount: 0 },
    { username: "albayrakcihann", image: "https://i.hizliresim.com/hfoamw5.jpg", favCount: 0 }
  ];

  const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
  const favMap = JSON.parse(localStorage.getItem("favMap") || "{}");
  const ratingsMap = JSON.parse(localStorage.getItem("ratingsMap") || "{}");
  const container = document.getElementById("container");
  const heartSound = document.getElementById("heartSound");
  const starClickSound = document.getElementById("starClickSound");
  const showFavoritesBtn = document.getElementById("showFavoritesBtn");
  const toast = document.getElementById("toast");
  let showingFavorites = false;

  function showToast(msg) {
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 2000);
  }

  function isFav(name) {
    return favorites.includes(name);
  }

  function toggleFavorite(name, event) {
    event.stopPropagation();
    const box = event.target.closest('.box');
    const idx = favorites.indexOf(name);
    if (idx > -1) {
      favorites.splice(idx, 1);
      favMap[name] = Math.max((favMap[name] || 1) - 1, 0);
    } else {
      favorites.push(name);
      favMap[name] = (favMap[name] || 0) + 1;
      createFallingHearts(5);
      if (heartSound) heartSound.play();
      showToast("Added to Favorites!");
    }
    localStorage.setItem("favorites", JSON.stringify(favorites));
    localStorage.setItem("favMap", JSON.stringify(favMap));
    renderItems(showingFavorites);
  }

  function createFallingHearts(count) {
    for (let i = 0; i < count; i++) {
      const heart = document.createElement("div");
      heart.className = "falling-heart";
      heart.textContent = "❤️";
      heart.style.left = (Math.random() * window.innerWidth) + "px";
      document.body.appendChild(heart);
      heart.addEventListener("animationend", () => heart.remove());
    }
  }

  function createFallingStars(count) {
    for (let i = 0; i < count; i++) {
      const star = document.createElement("div");
      star.className = "falling-star";
      star.textContent = "★";
      star.style.left = (Math.random() * window.innerWidth) + "px";
      document.body.appendChild(star);
      star.addEventListener("animationend", () => star.remove());
    }
  }

  function renderItems(filterFavorites = false) {
    showingFavorites = filterFavorites;
    const search = document.getElementById("search").value.toLowerCase();
    const sort = document.getElementById("sortSelect").value;

    let filtered = users.filter(u => u.username.toLowerCase().includes(search));

    if (filterFavorites) {
      filtered = filtered.filter(u => isFav(u.username));
    }

    if (sort === "az") filtered.sort((a, b) => a.username.localeCompare(b.username));
    if (sort === "za") filtered.sort((a, b) => b.username.localeCompare(a.username));
    if (sort === "favcount") filtered.sort((a, b) => (favMap[b.username] || 0) - (favMap[a.username] || 0));

    container.innerHTML = "";
    filtered.forEach(user => {
      const div = document.createElement("div");
      div.className = "box";
      div.onclick = () => window.location.href = `/${user.username}`;

      const imgTag = user.image ? `<img src="${user.image}" class="profile-pic">` : "";
      const favClass = isFav(user.username) ? "" : "inactive";

      const username = document.createElement("div");
      username.className = "username";
      username.textContent = `@${user.username}`;

      const stars = document.createElement("div");
      stars.className = "stars-row";
      let rating = ratingsMap[user.username] || 0;
      for (let i = 1; i <= 5; i++) {
        const star = document.createElement("span");
        star.className = "star";
        star.textContent = "★";
        if (i <= rating) star.classList.add("selected");
        star.addEventListener("click", (e) => {
          e.stopPropagation();
          rating = i;
          ratingsMap[user.username] = rating;
          localStorage.setItem("ratingsMap", JSON.stringify(ratingsMap));
          updateStars();
          if (starClickSound) starClickSound.play();
          createFallingStars(i);
        });
        stars.appendChild(star);
      }

      function updateStars() {
        const allStars = stars.querySelectorAll(".star");
        allStars.forEach((star, idx) => {
          star.classList.toggle("selected", idx < rating);
        });
      }

      div.innerHTML = `
        <button class="favorite-btn ${favClass}" onclick="toggleFavorite('${user.username}', event)">❤</button>
        ${imgTag}
      `;

      div.appendChild(username);
      div.appendChild(stars);

      container.appendChild(div);
    });

    showFavoritesBtn.textContent = `❤️ Show Favorites ${favorites.length}`;
    showFavoritesBtn.disabled = favorites.length === 0;
  }

  document.getElementById("search").addEventListener("input", () => renderItems(showingFavorites));
  document.getElementById("sortSelect").addEventListener("change", () => renderItems(showingFavorites));
  showFavoritesBtn.addEventListener("click", () => {
    if (favorites.length === 0) return;
    renderItems(!showingFavorites);
  });

  renderItems();
</script>

</body>
</html>
